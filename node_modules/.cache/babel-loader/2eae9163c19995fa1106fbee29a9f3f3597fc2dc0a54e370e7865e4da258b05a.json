{"ast":null,"code":"import { createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-3e0b8eef\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"character-generator-page\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode($setup[\"CharacterGeneratorRoller\"], {\n    gameSystemName: $setup.gameSystem.value?.name,\n    loading: $setup.loading,\n    dropdownOptions: $setup.dropdownOptions,\n    generatorDropdownOptions: $setup.generatorDropdownOptions,\n    onRollCharacter: _cache[0] || (_cache[0] = $event => $setup.rollNewCharacter()),\n    onSetNameStyle: _cache[1] || (_cache[1] = e => $setup.generatorSelectedOptions.nameStyle = e),\n    onSetAncestry: _cache[2] || (_cache[2] = e => $setup.selectAncestry(e)),\n    onSetClass: _cache[3] || (_cache[3] = e => $setup.selectCharacterClass(e)),\n    onSetBackground: _cache[4] || (_cache[4] = e => $setup.generatorSelectedOptions.background = e),\n    onSetLineage: _cache[5] || (_cache[5] = e => $setup.generatorSelectedOptions.lineage = e),\n    onSetSubclass: _cache[6] || (_cache[6] = e => $setup.generatorSelectedOptions.characterSubclass = e),\n    onSetAppearance: _cache[7] || (_cache[7] = e => $setup.generatorSelectedOptions.appearance = e)\n  }, null, 8 /* PROPS */, [\"gameSystemName\", \"loading\", \"dropdownOptions\", \"generatorDropdownOptions\"]), _createVNode($setup[\"CharacterCard\"], {\n    dropdownOptions: $setup.dropdownOptions,\n    cardDropdownOptions: $setup.cardDropdownOptions,\n    generatorSelectedOptions: $setup.generatorSelectedOptions,\n    selectedOptions: $setup.cardSelectedOptions,\n    loading: $setup.loading\n  }, null, 8 /* PROPS */, [\"dropdownOptions\", \"cardDropdownOptions\", \"generatorSelectedOptions\", \"selectedOptions\", \"loading\"])]);\n}","map":{"version":3,"names":["class","_createElementBlock","_hoisted_1","_createVNode","$setup","gameSystemName","gameSystem","value","name","loading","dropdownOptions","generatorDropdownOptions","onRollCharacter","_cache","$event","rollNewCharacter","onSetNameStyle","e","generatorSelectedOptions","nameStyle","onSetAncestry","selectAncestry","onSetClass","selectCharacterClass","onSetBackground","background","onSetLineage","lineage","onSetSubclass","characterSubclass","onSetAppearance","appearance","cardDropdownOptions","selectedOptions","cardSelectedOptions"],"sources":["/Users/lappy486/Code/pwf-games/src/components/CharacterGenerators/CharacterGeneratorPage.vue"],"sourcesContent":["<template>\n  <div class=\"character-generator-page\">\n    <CharacterGeneratorRoller :gameSystemName=\"gameSystem.value?.name\"\n                                 :loading=\"loading\"\n                                 :dropdownOptions=\"dropdownOptions\"\n                                 :generatorDropdownOptions=\"generatorDropdownOptions\"\n                                 @rollCharacter=\"rollNewCharacter()\"\n                                 @setNameStyle=\"e => generatorSelectedOptions.nameStyle = e\"\n                                 @setAncestry=\"e => selectAncestry(e)\" \n                                 @setClass=\"e => selectCharacterClass(e)\" \n                                 @setBackground=\"e => generatorSelectedOptions.background = e\" \n                                 @setLineage=\"e => generatorSelectedOptions.lineage = e\" \n                                 @setSubclass=\"e => generatorSelectedOptions.characterSubclass = e\" \n                                 @setAppearance=\"e => generatorSelectedOptions.appearance = e\" />\n    <CharacterCard :dropdownOptions=\"dropdownOptions\"\n                      :cardDropdownOptions=\"cardDropdownOptions\"\n                      :generatorSelectedOptions=\"generatorSelectedOptions\"\n                      :selectedOptions=\"cardSelectedOptions\"\n                      :loading=\"loading\" />\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive } from 'vue'\n\nimport CharacterGeneratorRoller from './CharacterGeneratorRoller.vue';\nimport CharacterCard from '../Cards/CharacterCard.vue';\n\nconst props = defineProps({\n  gameSystemKey: String\n});\n\nconst loading = ref(true);\nconst baseUrl = 'http://localhost:3000/api/v1/character_generator';\nconst gameSystem = reactive({});\nconst dropdownOptions = reactive({});\n\n// Move into api file?\nfunction fetchBaseData () {\n  fetch(`${baseUrl}/base_data/${gameSystem.value.id}`, {\n    method: 'get'\n  }).then((res) => {\n    return res.json();\n  }).then((res) => {\n    dropdownOptions.value = {\n      ancestries: res.ancestries || [],\n      characterClasses: res.player_classes || [],\n      nameStyles: res.name_styles || [],\n      backgrounds: res.backgrounds || [],\n      appearances: res.appearances || []\n    }\n  });\n  loading.value = false;\n}\n\nfetch(`${baseUrl}/game_system/${props.gameSystemKey}`, {\n  method: 'get'\n}).then((res) => {\n  return res.json();\n}).then((res) => {\n  gameSystem.value = res.game_system;\n  fetchBaseData();\n});\n\nconst baseOptions = {\n  ancestry: null,\n  appearance: null,\n  background: null,\n  characterClass: null,\n  characterName: null\n};\nconst subOptions = {\n  lineage: null,\n  characterSubclass: null\n};\nconst generatorSpecific = {\n  nameStyle: null\n};\n\n// Generator data\nconst generatorSelectedOptions = reactive({\n  ...baseOptions,\n  ...subOptions,\n  ...generatorSpecific\n});\n\nconst generatorDropdownOptions = reactive({\n  characterSubclasses: [],\n  lineages: []\n});\n\n// Card data\nconst cardSelectedOptions = reactive({\n  ...baseOptions,\n  ...subOptions\n});\n\nconst cardDropdownOptions = reactive({\n  characterSubclasses: [],\n  lineages: []\n});\n\n// Fetch data as selections change\nfunction fetchLineages (ancestryId) {\n  return fetch(`${baseUrl}/lineages/${gameSystem.value.id}/${ancestryId}`, {\n    method: 'get'\n  }).then((res) => {\n    return res.json();\n  }).then((res) => {\n    return res.lineages;\n  });\n}\n\nfunction fetchCharacterSubclasses (characterClassId) {\n  return fetch(`${baseUrl}/player_subclasses/${gameSystem.value.id}/${characterClassId}`, {\n    method: 'get'\n  }).then((res) => {\n    return res.json();\n  }).then((res) => {\n    return res.player_subclasses;\n  });\n}\n\n// Update data\nfunction selectAncestry (newAncestry) {\n  generatorSelectedOptions.ancestry = newAncestry;\n  fetchLineages(newAncestry).then(res => {\n    generatorDropdownOptions.lineages = res;\n  });\n}\n\nfunction selectCharacterClass (newCharacterClass) {\n  generatorSelectedOptions.characterClass = newCharacterClass;\n  fetchCharacterSubclasses(newCharacterClass).then(res => {\n    generatorDropdownOptions.characterSubclasses = res;\n  });\n}\n\n// Character generation\nfunction generateAncestry () {\n  const ancestryIndex = Math.floor(Math.random() * dropdownOptions.value.ancestries.length);\n  const ancestryId = dropdownOptions.value.ancestries[ancestryIndex].id;\n  generateLineage(ancestryId);\n  return ancestryId;\n}\n\nfunction generateLineage (ancestryId) {\n  if (generatorSelectedOptions.lineage) {\n    cardSelectedOptions.lineage = generatorSelectedOptions.lineage;\n  } else if (generatorDropdownOptions.lineages.length) {\n    cardDropdownOptions.lineages = generatorDropdownOptions.lineages;\n    const lineageIndex = Math.floor(Math.random() * cardDropdownOptions.lineages.length);\n    cardSelectedOptions.lineage = cardDropdownOptions.lineages[lineageIndex];\n  } else {\n    fetchLineages(ancestryId).then(res => {\n      cardDropdownOptions.lineages = res;\n      const lineageIndex = Math.floor(Math.random() * cardDropdownOptions.lineages.length);\n      cardSelectedOptions.lineage = cardDropdownOptions.lineages[lineageIndex];\n    });\n  }\n}\n\nfunction generateAppearance () {\n  const appearanceIndex = Math.floor(Math.random() * (dropdownOptions.value.appearances.length));\n  return dropdownOptions.value.appearances[appearanceIndex].id;\n}\n\nfunction generateBackground () {\n  const backgroundIndex = Math.floor(Math.random() * (dropdownOptions.value.backgrounds.length));\n  return dropdownOptions.value.backgrounds[backgroundIndex].id;\n}\n\nfunction generateCharacterClass () {\n  const characterClassIndex = Math.floor(Math.random() * dropdownOptions.value.characterClasses.length);\n  const characterClassId = dropdownOptions.value.characterClasses[characterClassIndex].id;\n  generateCharacterSubclass(characterClassId);\n  return characterClassId;\n}\n\nfunction generateCharacterSubclass (characterClassId) {\n  if (generatorSelectedOptions.characterSubclass) {\n    cardSelectedOptions.characterSubclass = generatorSelectedOptions.characterSubclass;\n  } else if (generatorDropdownOptions.characterSubclasses.length) {\n    cardDropdownOptions.characterSubclasses = generatorDropdownOptions.characterSubclasses;\n    const subclassIndex = Math.floor(Math.random() * cardDropdownOptions.characterSubclasses.length);\n    cardSelectedOptions.characterSubclass = cardDropdownOptions.characterSubclasses[subclassIndex];\n  } else {\n    fetchCharacterSubclasses(characterClassId).then(res => {\n      cardDropdownOptions.characterSubclasses = res;\n      const subclassIndex = Math.floor(Math.random() * cardDropdownOptions.characterSubclasses.length);\n      cardSelectedOptions.characterSubclass = cardDropdownOptions.characterSubclasses[subclassIndex];\n    });\n  }\n}\n\nfunction generateCharacterName (selectedStyleId) {\n  let url = `${baseUrl}/character_name/${gameSystem.value.id}/style/`;\n  if (!isNaN(selectedStyleId)) {\n    url = url.concat(selectedStyleId);\n  } else {\n    const nameStyleIndex = Math.floor(Math.random() * dropdownOptions.value.nameStyles.length);\n    url = url.concat(dropdownOptions.value.nameStyles[nameStyleIndex]);\n  }\n\n  return fetch(url, {\n    method: 'get'\n  }).then((res) => {\n    return res.json();\n  }).then((res) => {\n    console.log(res.character_name);\n    return res.character_name;\n  });\n}\n\nfunction rollNewCharacter () {\n  Object.keys(baseOptions).forEach(key => {\n    if (generatorSelectedOptions[key]) {\n      cardSelectedOptions[key] = generatorSelectedOptions[key];\n\n      // TODO: Abstract out keys\n      if (key === 'ancestry') {\n        generateLineage(generatorSelectedOptions[key].id);\n      } else if (key === 'characterClass') {\n        generateCharacterSubclass(generatorSelectedOptions[key].id);\n      }\n    }\n    else {\n      switch (key) {\n        case 'ancestry':\n          cardSelectedOptions[key] = generateAncestry();\n          break;\n        case 'appearance':\n          cardSelectedOptions[key] = generateAppearance();\n          break;\n        case 'background':\n          cardSelectedOptions[key] = generateBackground();\n          break;\n        case 'characterClass':\n          cardSelectedOptions[key] = generateCharacterClass();\n          break;\n        default:\n          break;\n      }\n    }\n  });\n\n  cardSelectedOptions.characterName = generateCharacterName(generatorSelectedOptions.nameStyle?.id);\n}\n</script>\n\n<style scoped lang=\"scss\">\n@import \"./CharacterGeneratorPage.scss\";\n</style>\n"],"mappings":";;;EACOA,KAAK,EAAC;AAA0B;;uBAArCC,mBAAA,CAkBM,OAlBNC,UAkBM,GAjBJC,YAAA,CAW6FC,MAAA;IAXlEC,cAAc,EAAED,MAAA,CAAAE,UAAU,CAACC,KAAK,EAAEC,IAAI;IACnCC,OAAO,EAAEL,MAAA,CAAAK,OAAO;IAChBC,eAAe,EAAEN,MAAA,CAAAM,eAAe;IAChCC,wBAAwB,EAAEP,MAAA,CAAAO,wBAAwB;IAClDC,eAAa,EAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEV,MAAA,CAAAW,gBAAgB;IAC/BC,cAAY,EAAAH,MAAA,QAAAA,MAAA,MAAEI,CAAC,IAAIb,MAAA,CAAAc,wBAAwB,CAACC,SAAS,GAAGF,CAAC;IACzDG,aAAW,EAAAP,MAAA,QAAAA,MAAA,MAAEI,CAAC,IAAIb,MAAA,CAAAiB,cAAc,CAACJ,CAAC;IAClCK,UAAQ,EAAAT,MAAA,QAAAA,MAAA,MAAEI,CAAC,IAAIb,MAAA,CAAAmB,oBAAoB,CAACN,CAAC;IACrCO,eAAa,EAAAX,MAAA,QAAAA,MAAA,MAAEI,CAAC,IAAIb,MAAA,CAAAc,wBAAwB,CAACO,UAAU,GAAGR,CAAC;IAC3DS,YAAU,EAAAb,MAAA,QAAAA,MAAA,MAAEI,CAAC,IAAIb,MAAA,CAAAc,wBAAwB,CAACS,OAAO,GAAGV,CAAC;IACrDW,aAAW,EAAAf,MAAA,QAAAA,MAAA,MAAEI,CAAC,IAAIb,MAAA,CAAAc,wBAAwB,CAACW,iBAAiB,GAAGZ,CAAC;IAChEa,eAAa,EAAAjB,MAAA,QAAAA,MAAA,MAAEI,CAAC,IAAIb,MAAA,CAAAc,wBAAwB,CAACa,UAAU,GAAGd,CAAC;yGACzFd,YAAA,CAIuCC,MAAA;IAJvBM,eAAe,EAAEN,MAAA,CAAAM,eAAe;IAC7BsB,mBAAmB,EAAE5B,MAAA,CAAA4B,mBAAmB;IACxCd,wBAAwB,EAAEd,MAAA,CAAAc,wBAAwB;IAClDe,eAAe,EAAE7B,MAAA,CAAA8B,mBAAmB;IACpCzB,OAAO,EAAEL,MAAA,CAAAK"},"metadata":{},"sourceType":"module","externalDependencies":[]}