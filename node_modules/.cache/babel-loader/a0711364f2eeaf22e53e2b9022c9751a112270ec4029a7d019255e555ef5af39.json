{"ast":null,"code":"import { resolveComponent as _resolveComponent, createVNode as _createVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nconst _withScopeId = n => (_pushScopeId(\"data-v-3e0b8eef\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  className: \"character-generator-page\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_CharacterGeneratorRoller = _resolveComponent(\"CharacterGeneratorRoller\");\n  const _component_CharacterCard = _resolveComponent(\"CharacterCard\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createVNode(_component_CharacterGeneratorRoller, {\n    availableAncestries: $setup.availableAncestries,\n    availableClasses: $setup.availableClasses,\n    availableNameGenders: $setup.availableNameGenders,\n    availableNameStyles: $setup.availableNameStyles,\n    availableSubclasses: $setup.selectedClass ? $setup.availableSubclasses : [],\n    loading: $data.loading,\n    systemName: $data.gameSystem.name,\n    onRoll: _cache[0] || (_cache[0] = $event => $options.generateCharacter()),\n    onSelectAncestry: _cache[1] || (_cache[1] = e => $options.selectAncestry(e)),\n    onSelectClass: _cache[2] || (_cache[2] = e => $options.selectClass(e)),\n    onSelectGender: _cache[3] || (_cache[3] = e => $options.selectNameGender(e)),\n    onSelectStyle: _cache[4] || (_cache[4] = e => $options.selectNameStyle(e)),\n    onSelectSubclass: _cache[5] || (_cache[5] = e => $options.selectSubclass(e))\n  }, null, 8 /* PROPS */, [\"availableAncestries\", \"availableClasses\", \"availableNameGenders\", \"availableNameStyles\", \"availableSubclasses\", \"loading\", \"systemName\"]), _createVNode(_component_CharacterCard, {\n    availableAncestries: $setup.availableAncestries,\n    availableClasses: $setup.availableClasses,\n    availableSubclasses: $setup.sheetAvailableSubclasses,\n    presetCharName: $setup.characterName,\n    selectedAncestry: $setup.sheetAncestry,\n    selectedClass: $setup.sheetClass,\n    selectedSubclass: $setup.sheetSubclass\n  }, null, 8 /* PROPS */, [\"availableAncestries\", \"availableClasses\", \"availableSubclasses\", \"presetCharName\", \"selectedAncestry\", \"selectedClass\", \"selectedSubclass\"])]);\n}","map":{"version":3,"names":["className","_createElementBlock","_hoisted_1","_createVNode","_component_CharacterGeneratorRoller","availableAncestries","$setup","availableClasses","availableNameGenders","availableNameStyles","availableSubclasses","selectedClass","loading","$data","systemName","gameSystem","name","onRoll","_cache","$event","$options","generateCharacter","onSelectAncestry","e","selectAncestry","onSelectClass","selectClass","onSelectGender","selectNameGender","onSelectStyle","selectNameStyle","onSelectSubclass","selectSubclass","_component_CharacterCard","sheetAvailableSubclasses","presetCharName","characterName","selectedAncestry","sheetAncestry","sheetClass","selectedSubclass","sheetSubclass"],"sources":["/Users/lappy486/Code/pwf-games/src/components/CharacterGenerators/CharacterGeneratorPage.vue"],"sourcesContent":["<template>\n  <div className=\"character-generator-page\">\n    <CharacterGeneratorRoller :availableAncestries=\"availableAncestries\"\n                              :availableClasses=\"availableClasses\"\n                              :availableNameGenders=\"availableNameGenders\"\n                              :availableNameStyles=\"availableNameStyles\"\n                              :availableSubclasses=\"selectedClass ? availableSubclasses : []\"\n                              :loading=\"loading\"\n                              :systemName=\"gameSystem.name\"\n                              @roll=\"generateCharacter()\"\n                              @selectAncestry=\"e => selectAncestry(e)\"\n                              @selectClass=\"e => selectClass(e)\"\n                              @selectGender=\"e => selectNameGender(e)\" \n                              @selectStyle=\"e => selectNameStyle(e)\"\n                              @selectSubclass=\"e => selectSubclass(e)\" />\n    <CharacterCard :availableAncestries=\"availableAncestries\"\n                   :availableClasses=\"availableClasses\"\n                   :availableSubclasses=\"sheetAvailableSubclasses\"\n                   :presetCharName=\"characterName\"\n                   :selectedAncestry=\"sheetAncestry\"\n                   :selectedClass=\"sheetClass\"\n                   :selectedSubclass=\"sheetSubclass\" />\n    </div>\n</template>\n\n<script>\n/* eslint-disable */\nimport { ref } from 'vue';\n\nimport CharacterCard from \"../Cards/CharacterCard\";\nimport CharacterGeneratorRoller from \"./CharacterGeneratorRoller\";\n\nimport { fetchCharacterNameWithGender, fetchCharacterNameWithStyle, fetchNameGenders, fetchNameStyles } from './NameGenerator';\n\nexport default {\n  components: {\n    CharacterCard,\n    CharacterGeneratorRoller\n  },\n  props: {\n    gameSystemKey: {\n      type: String\n    }\n  },\n  data () {\n    return {\n      baseUrl: 'http://localhost:3000/api/v1/character_generator',\n      characterName: \"\",\n      gameSystem: {},\n      // Want to get key from params, retrieve id, name, uses ancestry\n      loading: true\n    }\n  },\n  setup () {\n    const characterName = ref(\"\");\n    const selectedAncestry = ref(\"\");\n    const selectedLineage = ref(\"\");\n    const selectedClass = ref(\"\");\n    const selectedSubclass = ref(\"\");\n    const selectedNameGender = ref(\"any\");\n    const selectedNameStyle = ref(\"\");\n    const sheetAncestry = ref(\"\");\n    const sheetLineage = ref(\"\");\n    const sheetClass = ref(\"\");\n    const sheetSubclass = ref(\"\");\n\n    const availableAncestries = ref([]);\n    const availableLineages = ref([]);\n    const availableClasses = ref([]);\n    const availableNameGenders = ref([]);\n    const availableNameStyles = ref([]);\n    const availableSubclasses = ref([]);\n    const sheetAvailableSubclasses = ref([]);\n\n    const useAncestry = ref(false);\n\n    return {\n      availableAncestries,\n      availableLineages,\n      availableClasses,\n      availableNameGenders,\n      availableNameStyles,\n      availableSubclasses,\n      characterName,\n      selectedAncestry,\n      selectedLineage,\n      selectedClass,\n      selectedSubclass,\n      selectedNameGender,\n      selectedNameStyle,\n      sheetAncestry,\n      sheetAvailableSubclasses,\n      sheetClass,\n      sheetSubclass,\n      useAncestry\n    }\n  },\n  methods: {\n    fetchGameSystem () {\n      return fetch(`${this.baseUrl}/game_system/${this.gameSystemKey}`, {\n        method: 'get'\n      }).then((res) => {\n        return res.json();\n      }).then((res) => {\n        this.gameSystem = res.game_system;\n        this.loading = false;\n      });\n    },\n    fetchAncestries () {\n      fetch(`${this.baseUrl}/ancestries/${this.gameSystem.id}`, {\n        method: 'get'\n      }).then((res) => {\n        return res.json();\n      }).then((res) => {\n        this.availableAncestries = res.ancestries;\n        this.useAncestry = this.availableAncestries?.length > 0;\n      });\n    },\n    fetchLineages () {\n      fetch(`${this.baseUrl}/lineages/${this.gameSystem.id}/${this.ancestryId}`, {\n        method: 'get'\n      }).then((res) => {\n        return res.json();\n      }).then((res) => {\n        this.availableLineages = res.lineages;\n      }); \n    },\n    fetchClasses () {\n      fetch(`${this.baseUrl}/player_classes/${this.gameSystem.id}`, {\n        method: 'get'\n      }).then((res) => {\n        return res.json();\n      }).then((res) => {\n        this.availableClasses = res.player_classes;\n      });\n    },\n    fetchSubclasses () {\n      const activeClass = !isNaN(this.selectedClass) ? this.selectedClass : this.sheetClass;\n      return fetch(`${this.baseUrl}/player_subclasses/${this.gameSystem.id}/${activeClass}`, {\n        method: 'get'\n      }).then((res) => {\n        return res.json();\n      }).then((res) => {\n        this.availableSubclasses = res.player_subclasses;\n      });\n    },\n    selectAncestry (ancestryId) {\n      this.selectedAncestry = ancestryId;\n      this.fetchLineages();\n    },\n    selectLineage (lineageId) {\n      this.selectedLineage = lineageId;\n    },\n    selectClass (classId) {\n      this.selectedClass = classId;\n      this.selectedSubclass = null;\n      this.fetchSubclasses();\n    },\n    selectSubclass (subclassId) {\n      this.selectedSubclass = subclassId;\n    },\n    selectNameGender (genderId) {\n      this.selectedNameGender = genderId;\n    },\n    selectNameStyle (styleId) {\n      this.selectedNameStyle = styleId;\n    },\n    generateCharacter() {\n      if (this.useAncestry) {\n        if (this.selectedAncestry) {\n          this.sheetAncestry = this.selectedAncestry;\n        } else {\n          const ancestryIndex = Math.floor(Math.random() * this.availableAncestries.length);\n          const ancestryId = this.availableAncestries[ancestryIndex].id\n          this.sheetAncestry = ancestryId;\n        }\n\n        if(this.selectedLineage) {\n          this.sheetLineage = this.selectedLineage\n        } else {\n          const lineageIndex = Math.floor(Math.random() * this.availableLineages.length);\n          this.sheetLineage = this.availableLineages[lineageIndex];\n        }\n      }\n\n      this.sheetAvailableSubclasses =  this.availableSubclasses;\n\n      if (!this.selectedClass) {\n        const classIndex = Math.floor(Math.random() * (this.availableClasses.length))\n        this.sheetClass = this.availableClasses[classIndex].id;\n      \n        this.fetchSubclasses().then(() => {\n          if (!this.selectedSubclass && this.availableSubclasses) {\n            const subclassIndex = Math.floor(Math.random() * (this.availableSubclasses.length))\n            this.sheetSubclass = this.availableSubclasses[subclassIndex].id;\n          }\n        });\n      } else {\n        this.sheetClass = this.selectedClass;\n\n        if (this.availableSubclasses) {\n          if (this.selectedSubclass){\n            this.sheetSubclass = this.selectedSubclass;\n          } else {\n            const subclassIndex = Math.floor(Math.random() * (this.availableSubclasses.length))\n            this.sheetSubclass = this.availableSubclasses[subclassIndex].id;\n          }\n        }\n      }\n\n\n      const url = `${this.baseUrl}/character_name/${this.gameSystem.id}`;\n\n      if (this.availableNameStyles.length) {\n        fetchCharacterNameWithStyle(url, this.selectedNameStyle, this.selectAncestry)\n          .then(res => {\n            this.characterName = res;\n          });\n      } else {\n        fetchCharacterNameWithGender(url, this.selectedNameGender, this.selectAncestry)\n          .then(res => {\n            this.characterName = res;\n          });\n      }\n    },\n    \n  },\n  created () {\n    this.fetchGameSystem().then(() => {\n      this.fetchAncestries();\n      this.fetchClasses();\n      fetchNameStyles(this.baseUrl, this.gameSystem.id).then(res => {\n        if (res?.length > 0) {\n          this.availableNameStyles = res;\n        } else {\n          fetchNameGenders(this.baseUrl).then(res => {\n            this.availableNameGenders = res;\n          });\n        }\n      });\n    });\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n@import \"./CharacterGeneratorPage.scss\";\n</style>"],"mappings":";;;EACOA,SAAS,EAAC;AAA0B;;;;uBAAzCC,mBAAA,CAqBQ,OArBRC,UAqBQ,GApBNC,YAAA,CAYqEC,mCAAA;IAZ1CC,mBAAmB,EAAEC,MAAA,CAAAD,mBAAmB;IACxCE,gBAAgB,EAAED,MAAA,CAAAC,gBAAgB;IAClCC,oBAAoB,EAAEF,MAAA,CAAAE,oBAAoB;IAC1CC,mBAAmB,EAAEH,MAAA,CAAAG,mBAAmB;IACxCC,mBAAmB,EAAEJ,MAAA,CAAAK,aAAa,GAAGL,MAAA,CAAAI,mBAAmB;IACxDE,OAAO,EAAEC,KAAA,CAAAD,OAAO;IAChBE,UAAU,EAAED,KAAA,CAAAE,UAAU,CAACC,IAAI;IAC3BC,MAAI,EAAAC,MAAA,QAAAA,MAAA,MAAAC,MAAA,IAAEC,QAAA,CAAAC,iBAAiB;IACvBC,gBAAc,EAAAJ,MAAA,QAAAA,MAAA,MAAEK,CAAC,IAAIH,QAAA,CAAAI,cAAc,CAACD,CAAC;IACrCE,aAAW,EAAAP,MAAA,QAAAA,MAAA,MAAEK,CAAC,IAAIH,QAAA,CAAAM,WAAW,CAACH,CAAC;IAC/BI,cAAY,EAAAT,MAAA,QAAAA,MAAA,MAAEK,CAAC,IAAIH,QAAA,CAAAQ,gBAAgB,CAACL,CAAC;IACrCM,aAAW,EAAAX,MAAA,QAAAA,MAAA,MAAEK,CAAC,IAAIH,QAAA,CAAAU,eAAe,CAACP,CAAC;IACnCQ,gBAAc,EAAAb,MAAA,QAAAA,MAAA,MAAEK,CAAC,IAAIH,QAAA,CAAAY,cAAc,CAACT,CAAC;uKAChEpB,YAAA,CAMmD8B,wBAAA;IANnC5B,mBAAmB,EAAEC,MAAA,CAAAD,mBAAmB;IACxCE,gBAAgB,EAAED,MAAA,CAAAC,gBAAgB;IAClCG,mBAAmB,EAAEJ,MAAA,CAAA4B,wBAAwB;IAC7CC,cAAc,EAAE7B,MAAA,CAAA8B,aAAa;IAC7BC,gBAAgB,EAAE/B,MAAA,CAAAgC,aAAa;IAC/B3B,aAAa,EAAEL,MAAA,CAAAiC,UAAU;IACzBC,gBAAgB,EAAElC,MAAA,CAAAmC"},"metadata":{},"sourceType":"module","externalDependencies":[]}